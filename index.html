<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Grokipedia</title>
  <style>
    body {font-family:Arial,Helvetica,sans-serif;margin:40px;line-height:1.6;background:#f9f9f9;color:#222;}
    h1 {font-size:2em;color:#111;}
    h2 {font-size:1.3em;color:#444;border-bottom:2px solid #ddd;padding-bottom:5px;}
    input {padding:8px;font-size:1em;width:220px;margin-right:8px;}
    button {padding:8px 12px;font-size:1em;background:#0077cc;color:white;border:none;cursor:pointer;}
    button:hover {background:#005fa3;}
    .section {margin:30px 0;padding:15px;background:white;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,0.1);}
    .source {margin:8px 0;font-size:0.95em;}
    .source a {color:#0077cc;text-decoration:none;}
    .source a:hover {text-decoration:underline;}
    .bias {display:inline-block;padding:2px 6px;border-radius:4px;font-size:0.8em;margin-left:8px;}
    .left {background:#ffcccc;color:#900;}
    .center {background:#ffffcc;color:#660;}
    .right {background:#ccddff;color:#006;}
    .loading {color:#777;font-style:italic;}
  </style>
</head>
<body>
  <h1>Grokipedia</h1>
  <p><strong>Real-Time Truth Engine • Bias-Free • Source-Linked</strong></p>

  <div class="section" id="sources">
    <h2>Sources Output</h2>
    <div id="sourcesOutput">-- Results will appear here --</div>
  </div>

  <div class="section" id="news">
    <h2>News Results</h2>
    <input type="text" id="query" placeholder="Enter topic..." />
    <button onclick="fetchNews()">Get Headlines</button>
    <div id="newsOutput" style="margin-top:15px;">-- Aggregated headlines --</div>
  </div>

  <div class="section" id="bias">
    <h2>Bias Results</h2>
    <div id="biasOutput">-- Left / Center / Right lean --</div>
  </div>

  <div class="section" id="factcheck">
    <h2>Fact Check</h2>
    <div id="factcheckOutput">-- Verified claims --</div>
  </div>

  <hr style="border:1px dashed #ccc;margin:40px 0;" />

  <script>
    const sources = [
      {name: "BBC News", rss: "https://feeds.bbci.co.uk/news/rss.xml", bias: "center"},
      {name: "Reuters", rss: "https://agency.reuters.com/en/rss.xml", bias: "center"},
      {name: "AP News", rss: "https://feeds.feedburner.com/AssociatedPress", bias: "center"},
      {name: "NPR", rss: "https://feeds.npr.org/1001/rss.xml", bias: "left"},
      {name: "Fox News", rss: "http://feeds.foxnews.com/foxnews/latest", bias: "right"},
      {name: "Washington Post", rss: "http://feeds.washingtonpost.com/rss/politics", bias: "left"},
      {name: "New York Post", rss: "https://nypost.com/feed/", bias: "right"}
    ];

    const biasMap = {left: "Left", center: "Center", right: "Right"};
    const biasClass = {left: "left", center: "center", right: "right"};

    async function fetchRSS(url) {
      const proxy = "https://api.allorigins.win/raw?url=";
      const res = await fetch(proxy + encodeURIComponent(url));
      const text = await res.text();
      const parser = new DOMParser();
      return parser.parseFromString(text, "text/xml");
    }

    async function fetchNews() {
      const query = document.getElementById("query").value.toLowerCase().trim() || "";
      const newsDiv = document.getElementById("newsOutput");
      const sourcesDiv = document.getElementById("sourcesOutput");
      const biasDiv = document.getElementById("biasOutput");

      newsDiv.innerHTML = "<p class='loading'>Fetching headlines...</p>";
      sourcesDiv.innerHTML = "";
      biasDiv.innerHTML = "";

      const results = {left:0, center:0, right:0};

      for (const src of sources) {
        try {
          const xml = await fetchRSS(src.rss);
          const items = xml.querySelectorAll("item");
          let count = 0;
          items.forEach(item => {
            if (count >= 5) return;
            const title = item.querySelector("title")?.textContent || "";
            const link = item.querySelector("link")?.textContent || "";
            const desc = item.querySelector("description")?.textContent || "";
            if (query && !title.toLowerCase().includes(query) && !desc.toLowerCase().includes(query)) return;

            const div = document.createElement("div");
            div.className = "source";
            div.innerHTML = `<a href="${link}" target="_blank">${title}</a> 
              <span class="bias ${biasClass[src.bias]}">${biasMap[src.bias]}</span>`;
            newsDiv.appendChild(div);
            count++;
            results[src.bias]++;
          });
          if (count > 0) {
            sourcesDiv.innerHTML += `<p>• ${src.name} (${count} stories)</p>`;
          }
        } catch (e) {
          console.log(`Failed: ${src.name}`);
        }
      }

      if (newsDiv.innerHTML.includes("loading")) {
        newsDiv.innerHTML = "<p>No results found. Try a different topic.</p>";
      }

      biasDiv.innerHTML = `
        <p>Left: ${results.left} • Center: ${results.center} • Right: ${results.right}</p>
      `;
    }

    // Auto-load top headlines on page load
    window.onload = () => fetchNews();
  </script>
</body>
</html>
